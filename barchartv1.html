<!doctype html>
<html lang="en-US">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>La Planche à Repasser</title>
    <link href="css/singlePageTemplate.css" rel="stylesheet" type="text/css">
    <!--The following script tag downloads a font from the Adobe Edge Web Fonts server for use within the web page. We recommend that you do not modify it.-->
    <script>var __adobewebfontsappname__ = "dreamweaver"</script>
    <script src="http://use.edgefonts.net/source-sans-pro:n2:default.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.12.0/d3.min.js"></script>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
    <script
            src="https://code.jquery.com/jquery-3.2.1.min.js"
            integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
            crossorigin="anonymous"></script>
<body>
<div class="container" style="text-align: center">
    <H1>La Planche à Repasser</H1>

    <div class="container" style="text-align: center">
        <h2>Barchart</h2>

        <div class="row">
            <div class="col-xs-12">
                <svg width="300" height="300" id="barchart"></svg>
            </div>
        </div>
    </div>
</div>

</body>
<script>


    function bar_chart() {
// Chart initialization
        console.log(d3.select("#barchart"));
        var svg = d3.select("#barchart"),
            margin = {top: 20, right: 20, bottom: 30, left: 40},
            width = +svg.attr("width") - margin.left - margin.right,
            height = +svg.attr("height") - margin.top - margin.bottom,
            g = svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");

// X axis
        var x = d3.scaleBand()
            .rangeRound([0, width])
            .paddingInner(0.1);

// y axis
        var y = d3.scaleLinear()
            .rangeRound([height, 0]);

// Group by status


        //load data
        d3.csv("movie_IMDB.csv", function (error, data) {
            if (error) throw error;
            data.forEach(function (d) {
                var genres = d.genres.split("|");
                genres.sort(genres, function (a, b) {
                    return d3.ascending(a, b);
                });
                d.new_genres = genres.join('|');
            });
            data.filter(function(d){
                return d.new_genres.includes('Sci-Fi');
            });

            var nested = d3.nest()
                .key(function (d) {
                    if (d.new_genres.includes('Sci-Fi')) {
                        return "sci";
                    } else {
                        return "nogenres";
                    }
                })
                .rollup(function (leaves) {
                    return {
                        'count': leaves.length,
                        'total': d3.sum(leaves, function (d) {
                            return (d.new_genres);
                        })

                    }
                })
                .entries(data);
            nested.sort(function(a,b){
                return d3.descending(a.value.count, b.value.count)
            });
            console.log(nested);
            console.log(nested.slice(0,10));


//console.log(nested_data);

// Color scale
            var z = d3.scaleOrdinal()
                .range("#0d1788");

// Set domains of axes scales
            x.domain(nested.map(function (d) {
                return d.key;
            }));
            y.domain([0, d3.max(nested, function (d) {
                return d.values.length;
            })]);
            z.domain(nested.map(function (d) {
                return d.key;
            }))

// Draw rect
            g.selectAll("rect")
                .data(nested)
                .enter().append("rect")
                .attr("x", function (d) {
                    return x(d.key);
                })
                .attr("y", function (d) {
                    return y(d.values.length);
                })
                .attr("height", function (d) {
                    return height - y(d.values.length);
                })
                .attr("width", x.bandwidth())
                //.attr("fill", "red")
                .attr("fill", function (d, i) {
                    return z(d.key);
                })

// Draw x axis
            g.append("g")
                .attr("class", "axis")
                .attr("transform", "translate(0," + height + ")")
                .call(d3.axisBottom(x));

// Draw y axis
            g.append("g")
                .attr("class", "axis")
                .call(d3.axisLeft(y).ticks(null, "s"))

        })

        function type(d) {
            return d;
        }
    }

    bar_chart();
    //function data_loaded(data_) {
    //data = data_;
    //console.log(data_);
    //var date_format = d3.timeParse("%Y");
    //data.forEach(function (d, i) {
    //d.title_year = date_format(d.title_year);x
    //});
    // Filter years
    //data = data.filter(function (d) {
    //if (d.title_year) {
    //return +d.title_year.getFullYear() > 1920;
    //} else {
    //return false;
    //}
    //})

</script>
</html>
